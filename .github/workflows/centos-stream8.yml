jobs:
  test_c8s:
    name: test_c8s
    runs-on: ubuntu-latest
    environment: centosduffy
    steps:
      - uses: "actions/checkout@v2"
      - run: printf '%s\n' "$DUFFYY_SSH_PRIVATE_KEY" > /tmp/id_centos_stream
        env:
            DUFFYY_SSH_PRIVATE_KEY:  ${{ secrets.DUFFYY_SSH_PRIVATE_KEY }}
      - run: chmod 600 /tmp/id_centos_stream
      - run: sudo python3 -m pip pydantic=1.10.10 install duffy fabric httpx
      - run: python3 t_functional_duffy_runner/src/__main__.py --arch=x86 --release=centos-8s --sshkey=/tmp/id_centos_stream
        env:
            DUFFY_AUTH_NAME: ${{ secrets.DUFFY_AUTH_NAME }}
            DUFFY_AUTH_KEY: ${{secrets.DUFFY_AUTH_KEY}}
  test_c9s:
    name: test_9s
    runs-on: ubuntu-latest
    environment: centosduffy
    steps:
      - uses: "actions/checkout@v2"
      - run: printf '%s\n' "$DUFFYY_SSH_PRIVATE_KEY" > /tmp/id_centos_stream
        env:
            DUFFYY_SSH_PRIVATE_KEY:  ${{ secrets.DUFFYY_SSH_PRIVATE_KEY }}
      - run: chmod 600 /tmp/id_centos_stream
      - run: sudo python3 -m pip pydantic=1.10.10 install duffy fabric httpx
      - run: python3 t_functional_duffy_runner/src/__main__.py --arch=x86 --release=centos-9s --sshkey=/tmp/id_centos_stream
        env:
            DUFFY_AUTH_NAME: ${{ secrets.DUFFY_AUTH_NAME }}
            DUFFY_AUTH_KEY: ${{secrets.DUFFY_AUTH_KEY}}

name: Testing
on:
 pull_request_target: 
    branches: [ master ]
 push: 
    branches: [ master ]
